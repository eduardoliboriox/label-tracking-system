{% extends "base.html" %}
{% block title %}Ao Vivo{% endblock %}

{% block content %}

<div class="container-fluid mt-2 px-0">

    <!-- Cabe√ßalho -->
    <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
        <h3 class="fw-bold page-title mb-0 text-center">
            <img src="{{ url_for('static', filename='icons/logo-page-live.png') }}"
                class="title-inline-icon"
                alt="Produ√ß√£o em Tempo Real">
            Produ√ß√£o em Tempo Real
        </h3>
    </div>

<div class="live-mobile-filtros">

    <!-- Datas -->
    <form method="get" class="live-mobile-datas">

        <div>
            <label class="fw-bold">Data Inicial</label>
            <input type="date" name="data_ini"
                   class="form-control form-control-sm"
                   value="{{ data_ini }}">
        </div>

        <div>
            <label class="fw-bold">Data Final</label>
            <input type="date" name="data_fim"
                   class="form-control form-control-sm"
                   value="{{ data_fim }}">
        </div>

    </form>

    <!-- LINHA MOBILE (FILTRAR | SETOR | BUSCA) -->
    <div class="linha-filtros-mobile-live">

        <!-- Bot√£o Filtrar -->
        <button class="btn btn-primary btn-sm fw-bold">
            Filtrar
        </button>

        <!-- Setor -->
        <select class="form-select form-select-sm fw-bold"
                onchange="filterBySetor(this.value)">
                <option value="">SETORES</option>
                <option value="PTH">PTH</option>
                <option value="SMT">SMT</option>
                <option value="IM">IM</option>
                <option value="PA">PA</option>
                <option value="ESTOQUE">ESTOQUE</option>
                <option value="TODOS">TODOS</option>
        </select>

        <!-- Busca -->
        <input type="text"
               id="searchInputMobile"
               class="form-control form-control-sm"
               placeholder="Buscar por...">

    </div>

</div>

<div class="page-live">

    <!-- FILTROS (SEM CARD) -->
    <div class="d-flex flex-wrap align-items-end gap-2 mb-2">

        <!-- Datas -->
        <form method="get" class="d-flex flex-wrap align-items-end gap-2">

            <div>
                <label class="fw-bold mb-0">Data inicial</label>
                <input type="date" name="data_ini"
                       class="form-control form-control-sm"
                       value="{{ data_ini }}">
            </div>

            <div>
                <label class="fw-bold mb-0">Data final</label>
                <input type="date" name="data_fim"
                       class="form-control form-control-sm"
                       value="{{ data_fim }}">
            </div>

            <div>
                <button class="btn btn-primary btn-sm fw-bold">
                    üîç Filtrar
                </button>
            </div>

        </form>

        <!-- Setores + Busca -->
         
        <div class="filtros-container mt-1">

            <div class="d-flex flex-wrap gap-2">
                <button class="btn btn-outline-dark btn-sm fw-bold btn-setor" onclick="filterBySetor('PTH')">PTH</button>
                <button class="btn btn-outline-dark btn-sm fw-bold btn-setor" onclick="filterBySetor('SMT')">SMT</button>
                <button class="btn btn-outline-dark btn-sm fw-bold btn-setor" onclick="filterBySetor('IM')">IM</button>
                <button class="btn btn-outline-dark btn-sm fw-bold btn-setor" onclick="filterBySetor('PA')">PA</button>
                <button class="btn btn-outline-dark btn-sm fw-bold btn-setor" onclick="filterBySetor('ESTOQUE')">Estoque</button>
                <button class="btn btn-outline-secondary btn-sm fw-bold btn-setor" onclick="filterBySetor('TODOS')">Mostrar Todos</button>
            </div>

            <form id="searchForm">
                <input type="text" id="searchInput"
                       class="form-control form-control-sm"
                       placeholder="Buscar por...">
            </form>

        </div>
    </div>
</div>

<!-- TABELA  -->
<div class="container-fluid px-0">
    <div class="card shadow-sm">
        <div class="card-body px-2 px-md-1">
            <div class="table-responsive">
                <table class="table table-sm table-striped table-bordered align-middle w-100 text-nowrap">
                    <thead class="table-primary text-center">
                        <tr>
                            <th>Modelo</th>
                            <th>Cliente</th>
                            <th>OP</th>
                            <th>Produzido</th>
                            <th>Setor</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="opsTableBody">
                        {% for op in ops %}
                        <tr class="text-center" data-setor="{{ op.setor }}">
                            <td>{{ op.modelo }}</td>
                            <td>{{ op.cliente }}</td>
                            <td>{{ op.op }}</td>
                            <td class="fw-bold">{{ op.produzido }}</td>
                            <td>
                                <span class="badge bg-secondary">{{ op.setor }}</span>
                            </td>
                            <td>
                                <a href="{{ url_for('live_consultar', op=op.op) }}"
                                class="btn btn-sm btn-outline-primary fw-bold">
                                    üëÅÔ∏è Consultar
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


</div>

<!-- Scripts -->

<script>
document.getElementById("searchInputMobile")?.addEventListener("input", function () {
    const search = this.value.toUpperCase();

    document.querySelectorAll("#opsTableBody tr").forEach(row => {
        row.style.display = row.innerText.toUpperCase().includes(search)
            ? ""
            : "none";
    });
});
</script>

<script>
function filterBySetor(setor) {
    document.querySelectorAll('#opsTableBody tr').forEach(row => {
        if (setor === 'TODOS' || row.dataset.setor === setor) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}
</script>

{% endblock %}
